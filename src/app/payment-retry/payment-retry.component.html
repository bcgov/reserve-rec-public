<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
      <div class="card shadow">
        <div class="card-body">
          <h2 class="card-title text-danger">
            <i class="bi bi-exclamation-triangle-fill me-2"></i>
            Payment Failed
          </h2>

          @if (bookingError()) {
            <div class="alert alert-danger" role="alert">
              <strong>Error:</strong> {{ bookingError() }}
            </div>
            <div class="d-grid gap-2">
              <button class="btn btn-primary" (click)="goHome()">
                Return to Home
              </button>
            </div>
          } @else {
            <div class="alert alert-warning" role="alert">
              {{ errorMessage() }}
            </div>

            @if (booking()) {
              <div class="mb-4">
                <h5>Booking Details</h5>
                <dl class="row">
                  <dt class="col-sm-4">Activity:</dt>
                  <dd class="col-sm-8">{{ booking().displayName }}</dd>

                  <dt class="col-sm-4">Check-in:</dt>
                  <dd class="col-sm-8">{{ booking().startDate | date:'mediumDate' }}</dd>

                  <dt class="col-sm-4">Check-out:</dt>
                  <dd class="col-sm-8">{{ booking().endDate | date:'mediumDate' }}</dd>

                  @if (booking().feeInformation) {
                    <dt class="col-sm-4">Total Amount:</dt>
                    <dd class="col-sm-8">
                      <strong>${{ booking().feeInformation.total | number:'1.2-2' }}</strong>
                    </dd>
                  }

                  @if (booking().sessionExpiry) {
                    <dt class="col-sm-4">Session Expires:</dt>
                    <dd class="col-sm-8 text-danger">
                      {{ booking().sessionExpiry | date:'short' }}
                    </dd>
                  }
                </dl>
              </div>

              <div class="d-grid gap-2">
                <button 
                  class="btn btn-primary btn-lg" 
                  (click)="retryPayment()"
                  [disabled]="isProcessing()">
                  @if (isProcessing()) {
                    <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                    Processing...
                  } @else {
                    <i class="bi bi-credit-card me-2"></i>
                    Retry Payment
                  }
                </button>

                <button 
                  class="btn btn-outline-secondary" 
                  (click)="goHome()"
                  [disabled]="isProcessing()">
                  Return to Home
                </button>

                <button 
                  class="btn btn-outline-danger" 
                  (click)="cancelBooking()"
                  [disabled]="isProcessing()">
                  Cancel Booking
                </button>
              </div>
            } @else {
              <div class="text-center py-4">
                <div class="spinner-border text-primary" role="status">
                  <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-2">Loading booking details...</p>
              </div>
            }
          }
        </div>
      </div>

      <div class="mt-3 text-center">
        <small class="text-muted">
          Need help? <a href="mailto:support@bcparks.ca">Contact Support</a>
        </small>
      </div>
    </div>
  </div>
</div>
