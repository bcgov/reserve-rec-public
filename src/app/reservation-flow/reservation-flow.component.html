<!-- Stepper-based Reservation Flow Template -->
<div class="bg-container bg-grey">
  <div class="container">
    <!-- Breadcrumbs -->
    <div class="d-flex my-2 align-items-center">
      <a class="btn btn-link text-decoration-none" (click)="navigate()">Home</a>
      <i class="fa-regular fa-chevron-right mx-1 my-2"></i>
      <a class="btn btn-link text-decoration-none" routerLink="/cart">Cart</a>
      <i class="fa-regular fa-chevron-right mx-1 my-2"></i>
      <div class="mx-2 my-2">Checkout</div>
    </div>
    
    <h1 class="text-primary my-4">Checkout</h1>
    
    <div class="container-fluid border border-2 bg-white p-4">

    <app-progress-indicator
      [totalItems]="totalCartItems"
      [currentItemIndex]="currentCartItemIndex"
      [currentItemName]="cartItem?.activityName"
      [queueItems]="cartItems"
      (itemSwitched)="onItemSwitched($event)"
    >
    </app-progress-indicator>
      
      <!-- Step Content Container -->
      <div class="container-fluid border border-2 bg-grey p-4">
        <!-- Single step container with exclusive display logic -->
        <ng-container [ngSwitch]="stepperService.currentStepIndex()">
          
          <!-- Step 1: Confirm Details -->
          <div *ngSwitchCase="0" class="step-wrapper fade-in">
            <app-confirm-details-step-1
              [form]="form"
              [cartItem]="cartItem"
              [bookingSummary]="bookingSummary"
              (stepCompleted)="onStepCompleted($event)"
              (stepValidated)="onStepValidated($event)"
            ></app-confirm-details-step-1>
          </div>
          
          <!-- Step 2: Policy Review -->
          <div *ngSwitchCase="1" class="step-wrapper fade-in">
            <app-policy-review-step-2
              [form]="form"
              [cartItem]="cartItem"
              [bookingSummary]="bookingSummary"
              (stepCompleted)="onStepCompleted($event)"
              (stepValidated)="onStepValidated($event)"
            ></app-policy-review-step-2>
          </div>
          
          <!-- Step 3: Camping Party -->
          <div *ngSwitchCase="2" class="step-wrapper fade-in">
            <app-camping-party-step-3
              [form]="form"
              [user]="user"
              [cartItem]="cartItem"
              [bookingSummary]="bookingSummary"
              (stepCompleted)="onStepCompleted($event)"
              (stepValidated)="onStepValidated($event)"
            ></app-camping-party-step-3>
          </div>
          
          <!-- Step 4: Equipment -->
          <div *ngSwitchCase="3" class="step-wrapper fade-in">
            <app-equipment-step-4
              [form]="form"
              [cartItem]="cartItem"
              [bookingSummary]="bookingSummary"
              (stepCompleted)="onStepCompleted($event)"
              (stepValidated)="onStepValidated($event)"
            ></app-equipment-step-4>
          </div>
          
          <!-- Step 5: Payment & Final Submission -->
          <div *ngSwitchCase="4" class="step-wrapper fade-in">
            <app-payment-step-5
              [form]="form"
              [cartItem]="cartItem"
              [bookingSummary]="bookingSummary"
              [user]="user"
              (stepCompleted)="onStepCompleted($event)"
              (stepValidated)="onStepValidated($event)"
            ></app-payment-step-5>
          </div>
          
          <!-- Fallback for any unexpected state -->
          <div *ngSwitchDefault class="step-wrapper">
            <div class="alert alert-warning">
              <i class="fa-solid fa-exclamation-triangle me-2"></i>
              Invalid step state. Please refresh the page.
            </div>
          </div>
          
        </ng-container>
      </div>
    </div>
  </div>
</div>
